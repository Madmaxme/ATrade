version: '3.8'

services:
  trading-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: atrade-bot
    restart: unless-stopped
    
    # Environment variables
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - ALPACA_API_KEY=${ALPACA_API_KEY}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY}
      - LANGCHAIN_TRACING_V2=${LANGCHAIN_TRACING_V2:-false}
      - LANGCHAIN_API_KEY=${LANGCHAIN_API_KEY:-}
      - LANGCHAIN_PROJECT=${LANGCHAIN_PROJECT:-trading-bot}
      - TZ=America/New_York
    
    # Mount logs directory for persistence
    volumes:
      - .:/home/trader/app
    
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import trading_bot"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Optional: Redis for state persistence
  # redis:
  #   image: redis:7-alpine
  #   container_name: trading-bot-redis
  #   restart: unless-stopped
  #   volumes:
  #     - redis-data:/data

# volumes:
#   redis-data:
